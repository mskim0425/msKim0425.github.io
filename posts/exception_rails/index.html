<!DOCTYPE html><html lang="en" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Ruby on Rails Exception 그리고 트랜잭션" /><meta property="og:locale" content="en" /><meta name="description" content="예외처리 프로그램 실행중에 발생할 수 있는 예외를 처리하고 무엇보다 중단되지않도록 사용하는 기법이다. 루비에서의 예외처리 기본구조는 아래와같다. ```ruby begin # 예외가 발생할 수 있는 코드 rescue Exception =&gt; e # 예외가 발생했을 때 처리할 코드 else # 예외가 발생하지 않았을 때 실행할 코드 ensure # 항상 실행되는 코드 end" /><meta property="og:description" content="예외처리 프로그램 실행중에 발생할 수 있는 예외를 처리하고 무엇보다 중단되지않도록 사용하는 기법이다. 루비에서의 예외처리 기본구조는 아래와같다. ```ruby begin # 예외가 발생할 수 있는 코드 rescue Exception =&gt; e # 예외가 발생했을 때 처리할 코드 else # 예외가 발생하지 않았을 때 실행할 코드 ensure # 항상 실행되는 코드 end" /><link rel="canonical" href="https://mskim0425.github.io/posts/exception_rails/" /><meta property="og:url" content="https://mskim0425.github.io/posts/exception_rails/" /><meta property="og:site_name" content="SoThoughtful;" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2025-02-16T11:40:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Ruby on Rails Exception 그리고 트랜잭션" /><meta name="twitter:site" content="@" /><meta name="google-site-verification" content="jbF7fLQfFijq2Mi-8IkGRoUPQhLTlkTskBtbAoEmH4o" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2025-02-16T11:40:00+09:00","datePublished":"2025-02-16T11:40:00+09:00","description":"예외처리 프로그램 실행중에 발생할 수 있는 예외를 처리하고 무엇보다 중단되지않도록 사용하는 기법이다. 루비에서의 예외처리 기본구조는 아래와같다. ```ruby begin # 예외가 발생할 수 있는 코드 rescue Exception =&gt; e # 예외가 발생했을 때 처리할 코드 else # 예외가 발생하지 않았을 때 실행할 코드 ensure # 항상 실행되는 코드 end","headline":"Ruby on Rails Exception 그리고 트랜잭션","mainEntityOfPage":{"@type":"WebPage","@id":"https://mskim0425.github.io/posts/exception_rails/"},"url":"https://mskim0425.github.io/posts/exception_rails/"}</script><title>Ruby on Rails Exception 그리고 트랜잭션 | SoThoughtful;</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="SoThoughtful;"><meta name="application-name" content="SoThoughtful;"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="https://avatars.githubusercontent.com/u/107451298?s=400&u=e5165c561ac67ec7819798bbd37382f3630f4a99&v=4" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title"> <a href="/">SoThoughtful;</a></div><div class="site-subtitle font-italic">백엔드 개발자</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>REFERENCE</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/msKim0425" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['mins402kim','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="https://www.linkedin.com/in/%EB%AF%BC%EC%84%AD-%EA%B9%80-610901191/" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Ruby on Rails Exception 그리고 트랜잭션</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Ruby on Rails Exception 그리고 트랜잭션</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1739673600" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Feb 16, 2025 </em> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://github.com/msKim0425">Minsub Kim</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1689 words"> <em>9 min</em> read</span></div></div></div><div class="post-content"><h1 id="예외처리">예외처리</h1><p>프로그램 실행중에 발생할 수 있는 예외를 처리하고 무엇보다 중단되지않도록 사용하는 기법이다. <br /> 루비에서의 예외처리 기본구조는 아래와같다.</p><div class="language-ruby highlighter-rouge"><div class="code-header"> <span data-label-text="Ruby"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="k">begin</span>
  <span class="c1"># 예외가 발생할 수 있는 코드</span>
<span class="k">rescue</span> <span class="no">Exception</span> <span class="o">=&gt;</span> <span class="n">e</span>
  <span class="c1"># 예외가 발생했을 때 처리할 코드</span>
<span class="k">else</span>
  <span class="c1"># 예외가 발생하지 않았을 때 실행할 코드</span>
<span class="k">ensure</span>
  <span class="c1"># 항상 실행되는 코드</span>
<span class="k">end</span>

<span class="c1"># 커스텀 기본적인 예외처리 구조</span>
<span class="k">def</span> <span class="nf">controller</span>
 <span class="c1"># 작동</span>
 <span class="k">raise</span> <span class="s1">'에러메시지'</span> <span class="k">if</span> <span class="n">problem?</span> <span class="c1"># 비즈니스 로직상 예외처리</span>
<span class="k">rescue</span> <span class="no">Exception</span> <span class="o">-&gt;</span> <span class="n">e</span>
 <span class="c1">#작동중 에러가 터지면 여기로 작동되게 함</span>
<span class="k">end</span>
</pre></table></code></div></div><h3 id="rescue_from"><span class="mr-2">rescue_from</span><a href="#rescue_from" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><code class="language-plaintext highlighter-rouge">rescue_from</code>는 Ruby on Rails에서 Controller 수준에서 예외를 처리하는 데 사용되는 메서드이다. <br /> 이 메서드는 특정 예외가 발생했을 때, 지정된 메서드나 블록을 호출하여 예외를 처리할 수 있도록 함.</p><div class="language-ruby highlighter-rouge"><div class="code-header"> <span data-label-text="Ruby"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="k">class</span> <span class="nc">ApplicationController</span> <span class="o">&lt;</span> <span class="no">ActionController</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">rescue_from</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">RecordNotFound</span><span class="p">,</span> <span class="ss">with: :record_not_found</span>

  <span class="kp">private</span>

  <span class="k">def</span> <span class="nf">record_not_found</span><span class="p">(</span><span class="n">exception</span><span class="p">)</span>
    <span class="n">render</span> <span class="ss">json: </span><span class="p">{</span> <span class="ss">error: </span><span class="n">exception</span><span class="p">.</span><span class="nf">message</span> <span class="p">},</span> <span class="ss">status: :not_found</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></table></code></div></div><p>이 코드는 <code class="language-plaintext highlighter-rouge">ActiveRecord::RecordNotFound</code> 예외가 발생하면 <code class="language-plaintext highlighter-rouge">record_not_found</code> 메서드를 호출하여 JSON 응답을 반환하는 구조이다.</p><ul><li><strong>상속</strong>: <code class="language-plaintext highlighter-rouge">rescue_from</code>는 Controller 계층에서 상속된다. 즉, ApplicationController에서 정의한 예외 처리는 모든 Controller에서 자동으로 적용됨.<li><strong>우선순위</strong>: 예외 처리는 정의된 순서에 따라 우선순위가 결정되고 가장 구체적인 예외 처리가 먼저 호출된다.<li><strong>예외 전파</strong>: 예외 처리 메서드 내에서 또 다른 예외가 발생하면, 그 예외는 외부로 전파되지 않는다.</ul><blockquote class="prompt-tip"><div><p><code class="language-plaintext highlighter-rouge">rescue_from</code>는 <code class="language-plaintext highlighter-rouge">ActionController::BadRequest</code> 예외를 처리할 수 없다.</p></div></blockquote><h4 id="조건부-예외-처리"><span class="mr-2"><strong>조건부 예외 처리</strong></span><a href="#조건부-예외-처리" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>조건부로 예외를 처리하고 싶다면, 메서드 내에서 조건문을 사용할 수 있다. 하지만 <code class="language-plaintext highlighter-rouge">rescue_from</code> 자체에서 조건을 지정하는 것은 불가능하다.</p><div class="language-ruby highlighter-rouge"><div class="code-header"> <span data-label-text="Ruby"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="k">def</span> <span class="nf">record_not_found</span><span class="p">(</span><span class="n">exception</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">request</span><span class="p">.</span><span class="nf">local?</span>
    <span class="c1"># 로컬 환경에서의 처리</span>
  <span class="k">else</span>
    <span class="c1"># 다른 환경에서의 처리</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></table></code></div></div><h4 id="rescue_from-서비스단에서-사용가능"><span class="mr-2"><strong>rescue_from 서비스단에서 사용가능</strong></span><a href="#rescue_from-서비스단에서-사용가능" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><code class="language-plaintext highlighter-rouge">rescue_from</code>는 기본적으로 Controller에서만 사용할 수 있다. 하지만 <code class="language-plaintext highlighter-rouge">ActiveSupport::Rescuable</code> 모듈을 포함하여 다른 객체에서도 유사한 기능을 구현할 수 있다.</p><div class="language-ruby highlighter-rouge"><div class="code-header"> <span data-label-text="Ruby"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="k">class</span> <span class="nc">MyService</span>
  <span class="kp">include</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">Rescuable</span>

  <span class="n">rescue_from</span> <span class="no">MyCustomError</span> <span class="k">do</span> <span class="o">|</span><span class="n">exception</span><span class="o">|</span>
    <span class="c1"># 예외 처리 코드</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">perform</span>
    <span class="c1"># 코드</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></table></code></div></div><p>이렇게 하면 서비스 객체에서도 <code class="language-plaintext highlighter-rouge">rescue_from</code>와 같은 예외 처리 DSL을 사용할 수 있다. (굳이….)</p><h1 id="트랜젝션">트랜젝션</h1><p>트랜잭션은 여러 데이터베이스 작업을 하나의 논리적 단위로 묶어, 작업이 모두 성공하거나 모두 실패하는 것을 보장한다. <br /> Rails에서는 기본적으로 ActiveRecord::Base.transaction을 사용하여 트랜잭션을 구현할 수 있다.</p><div class="language-ruby highlighter-rouge"><div class="code-header"> <span data-label-text="Ruby"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span><span class="p">.</span><span class="nf">transaction</span> <span class="k">do</span>
  <span class="c1"># 여러 데이터베이스 작업</span>
<span class="k">end</span>
</pre></table></code></div></div><h3 id="requires_new"><span class="mr-2">requires_new</span><a href="#requires_new" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>새로운 독립적인 트랜잭션 생성을 하는 기능이다.<br /> 해당기능의 사용 예시를 들어보자, 사용자가 결제를 진행할 때, 결제 정보는 별도의 시스템에 저장되어야한다. 이때, 결제 정보 저장이 실패하더라도 메인 주문 정보는 저장되게하려고할때의 예시의 코드.</p><div class="language-ruby highlighter-rouge"><div class="code-header"> <span data-label-text="Ruby"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre><span class="k">class</span> <span class="nc">OrderController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">create</span>
    <span class="no">Order</span><span class="p">.</span><span class="nf">transaction</span> <span class="k">do</span>
      <span class="c1"># 주 주문 정보 저장</span>
      <span class="n">order</span> <span class="o">=</span> <span class="no">Order</span><span class="p">.</span><span class="nf">create!</span><span class="p">(</span><span class="ss">user_id: </span><span class="n">current_user</span><span class="p">.</span><span class="nf">id</span><span class="p">,</span> <span class="ss">total: </span><span class="mi">100</span><span class="p">)</span>
      
      <span class="c1"># 결제 정보 저장 (독립적인 트랜잭션)</span>
      <span class="no">Payment</span><span class="p">.</span><span class="nf">transaction</span><span class="p">(</span><span class="ss">requires_new: </span><span class="kp">true</span><span class="p">)</span> <span class="k">do</span>
        <span class="no">Payment</span><span class="p">.</span><span class="nf">create!</span><span class="p">(</span><span class="ss">order_id: </span><span class="n">order</span><span class="p">.</span><span class="nf">id</span><span class="p">,</span> <span class="ss">amount: </span><span class="mi">100</span><span class="p">)</span>
        <span class="c1"># 결제 시스템과 통신하는 코드</span>
        <span class="c1"># 여기서 예외가 발생하면 결제 정보만 롤백</span>
        <span class="k">raise</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Rollback</span> <span class="k">if</span> <span class="n">payment_failed?</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="kp">private</span>

  <span class="k">def</span> <span class="nf">payment_failed?</span>
    <span class="c1"># 결제 실패 여부를 판단하는 코드</span>
  <span class="k">end</span>
<span class="k">end</span>

</pre></table></code></div></div><h3 id="joinable"><span class="mr-2">joinable</span><a href="#joinable" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>루비 온 레일즈에서 joinable 옵션은 트랜잭션의 중첩 방식을 제어하는 데 사용된다. <br /> joinable 옵션은 기본적으로 true로 설정되어 있으며, 내부 트랜잭션이 외부 트랜잭션에 참여할 수 있다. <br /> 반면에 joinable: false를 설정하면 내부 트랜잭션이 외부 트랜잭션과 독립적으로 동작한다.</p><div class="language-ruby highlighter-rouge"><div class="code-header"> <span data-label-text="Ruby"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="no">User</span><span class="p">.</span><span class="nf">transaction</span> <span class="k">do</span>
  <span class="no">User</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="ss">username: </span><span class="s1">'Minsub'</span><span class="p">)</span>
  
  <span class="c1"># 내부 트랜잭션이 외부 트랜잭션에 참여하지 않도록 설정</span>
  <span class="no">User</span><span class="p">.</span><span class="nf">transaction</span><span class="p">(</span><span class="ss">joinable: </span><span class="kp">false</span><span class="p">)</span> <span class="k">do</span>
    <span class="no">User</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="ss">username: </span><span class="s1">'Sothoughtful'</span><span class="p">)</span>
    <span class="k">raise</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Rollback</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></table></code></div></div><h3 id="트랜잭션-전파"><span class="mr-2">트랜잭션 전파</span><a href="#트랜잭션-전파" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>루비 온 레일즈에서는 자바의 스프링처럼 명시적인 트랜잭션 전파 옵션이 제공되지 않는다고 한다. <br /> but <code class="language-plaintext highlighter-rouge">requires_new</code> 옵션을 사용하여 독립적인 트랜잭션을 생성할 수 있고, 자바의 <code class="language-plaintext highlighter-rouge">REQUIRES_NEW</code> 전파와 유사한 효과를 낼 수있다.</p><div class="table-wrapper"><table><thead><tr><th><strong>개념</strong><th><strong>루비 온 레일즈</strong><th><strong>자바 스프링</strong><tbody><tr><td><strong>새로운 트랜잭션 생성</strong><td><code class="language-plaintext highlighter-rouge">requires_new: true</code><td><code class="language-plaintext highlighter-rouge">Propagation.REQUIRES_NEW</code><tr><td><strong>기존 트랜잭션 참여</strong><td><code class="language-plaintext highlighter-rouge">joinable: true</code> (기본값)<td><code class="language-plaintext highlighter-rouge">Propagation.REQUIRED</code></table></div><div class="table-wrapper"><table><thead><tr><th><strong>옵션</strong><th><strong>트랜잭션 동작</strong><th><strong>내부 트랜잭션에서 예외 발생 시</strong><tbody><tr><td><strong><code class="language-plaintext highlighter-rouge">requires_new: true</code></strong><td><strong>새로운 독립적인 트랜잭션 생성</strong><td>외부 트랜잭션에 영향을 미치지 않음<tr><td><strong><code class="language-plaintext highlighter-rouge">joinable: true</code></strong><td><strong>기존 트랜잭션에 참여</strong><td>외부 트랜잭션도 롤백됨<tr><td><strong><code class="language-plaintext highlighter-rouge">joinable: false</code></strong><td><strong>기존 트랜잭션에 참여하지 않음</strong> (독립적인 트랜잭션 생성)<td>외부 트랜잭션에 영향을 미치지 않음</table></div><div class="language-ruby highlighter-rouge"><div class="code-header"> <span data-label-text="Ruby"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre><td class="rouge-code"><pre><span class="c1"># requires_new 사용</span>
<span class="no">User</span><span class="p">.</span><span class="nf">transaction</span> <span class="k">do</span>
  <span class="no">User</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="ss">username: </span><span class="s1">'Minsub'</span><span class="p">)</span>
  
  <span class="no">User</span><span class="p">.</span><span class="nf">transaction</span><span class="p">(</span><span class="ss">requires_new: </span><span class="kp">true</span><span class="p">)</span> <span class="k">do</span>
    <span class="no">User</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="ss">username: </span><span class="s1">'Sothoughtful'</span><span class="p">)</span>
    <span class="k">raise</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Rollback</span> <span class="c1"># 외부 트랜잭션에 영향을 미치지 않음</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># joinable: true (기본값)</span>
<span class="no">User</span><span class="p">.</span><span class="nf">transaction</span> <span class="k">do</span>
  <span class="no">User</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="ss">username: </span><span class="s1">'Minsub'</span><span class="p">)</span>
  
  <span class="no">User</span><span class="p">.</span><span class="nf">transaction</span> <span class="k">do</span>
    <span class="no">User</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="ss">username: </span><span class="s1">'Sothoughtful'</span><span class="p">)</span>
    <span class="k">raise</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Rollback</span> <span class="c1"># 외부 트랜잭션도 롤백됨</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># joinable: false</span>
<span class="no">User</span><span class="p">.</span><span class="nf">transaction</span> <span class="k">do</span>
  <span class="no">User</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="ss">username: </span><span class="s1">'Minsub'</span><span class="p">)</span>
  
  <span class="no">User</span><span class="p">.</span><span class="nf">transaction</span><span class="p">(</span><span class="ss">joinable: </span><span class="kp">false</span><span class="p">)</span> <span class="k">do</span>
    <span class="no">User</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="ss">username: </span><span class="s1">'Sothoughtful'</span><span class="p">)</span>
    <span class="k">raise</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Rollback</span> <span class="c1"># 외부 트랜잭션에 영향을 미치지 않음</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></table></code></div></div><blockquote class="prompt-tip"><div><p><strong><code class="language-plaintext highlighter-rouge">requires_new</code></strong>: 내부 트랜잭션이 외부 트랜잭션과 독립적으로 동작해야 할 때 사용<br /> <strong><code class="language-plaintext highlighter-rouge">joinable: false</code></strong>: 내부 트랜잭션이 외부 트랜잭션에 영향을 미치지 않도록 할 때 사용<br /> <strong>requires_new</strong> 와 <strong>joinable: false</strong> 가 비슷해 보이지만, requires_new: true는 명시적으로 새로운 독립적인 트랜잭션을 생성하도록 설계된 반면, joinable: false는 기존 트랜잭션에 참여하지 않도록 설정하는 것이다.</p></div></blockquote></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/web-development/'>Web Development</a>, <a href='/categories/performance-optimization/'>Performance Optimization</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/ruby-on-rails/" class="post-tag no-text-decoration" >ruby-on-rails</a> <a href="/tags/exception/" class="post-tag no-text-decoration" >exception</a> <a href="/tags/transaction/" class="post-tag no-text-decoration" >transaction</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Ruby+on+Rails+Exception+%EA%B7%B8%EB%A6%AC%EA%B3%A0+%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98+-+SoThoughtful%3B&url=https%3A%2F%2Fmskim0425.github.io%2Fposts%2Fexception_rails%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Ruby+on+Rails+Exception+%EA%B7%B8%EB%A6%AC%EA%B3%A0+%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98+-+SoThoughtful%3B&u=https%3A%2F%2Fmskim0425.github.io%2Fposts%2Fexception_rails%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fmskim0425.github.io%2Fposts%2Fexception_rails%2F&text=Ruby+on+Rails+Exception+%EA%B7%B8%EB%A6%AC%EA%B3%A0+%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98+-+SoThoughtful%3B" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fmskim0425.github.io%2Fposts%2Fexception_rails%2F" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div><script src="https://utteranc.es/client.js" repo="mskim0425/mskim0425.github.io" issue-term="pathname" theme="github-dark" crossorigin="anonymous" async> </script></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/java-basic-2/">Basic Confusing Questions Ⅱ 🤷‍♂️ (17개)</a><li><a href="/posts/query_series1/">mysql 쿼리 기능</a><li><a href="/posts/about_index/">INDEX에 관하여</a><li><a href="/posts/useful_gems/">Ruby GEM 시리즈</a><li><a href="/posts/debug_rails/">Rails 디버깅</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/cs/">cs</a> <a class="post-tag" href="/tags/design-pattern/">design pattern</a> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/spring/">spring</a> <a class="post-tag" href="/tags/mysql/">mysql</a> <a class="post-tag" href="/tags/rails/">rails</a> <a class="post-tag" href="/tags/sql/">sql</a> <a class="post-tag" href="/tags/algorithm/">algorithm</a> <a class="post-tag" href="/tags/questions/">questions</a> <a class="post-tag" href="/tags/ruby-on-rails/">ruby-on-rails</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4 mt-5"><div id="related-posts" class="mb-2 mb-sm-4"><h3 class="pt-2 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/rails_gc/"><div class="card-body"> <em class="small" data-ts="1737283200" data-df="ll" > Jan 19, 2025 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Ruby on Rails 성능 최적화: 가비지 컬렉션</h3><div class="text-muted small"><p> 정리하게된 계기 Rails App 경우 자바와 같이 object가 생성될떄 힙에 실제데이터를 올리고 있는데 메모리를 해제를 어떻게하는지 궁금해서 찾아보게 되었다. Ruby의 가비지 컬렉션(GC) 메커니즘은 메모리 관리의 핵심 부분이다. GC 모듈을 통해 이 과정을 이해하고 최적화할 수 있다. Rails 애플리케이션에서 메모리 사용...</p></div></div></a></div><div class="card"> <a href="/posts/rails_cache/"><div class="card-body"> <em class="small" data-ts="1737801600" data-df="ll" > Jan 25, 2025 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Ruby on Rails 성능 최적화: 레일즈 캐싱</h3><div class="text-muted small"><p> Rails에서 제공하는 캐싱(Caching)은 웹 애플리케이션의 성능을 향상시키기 위해 자주 사용되는 데이터나 결과를 저장하여 불필요한 데이터베이스 호출이나 복잡한 연산을 줄이는 기술이다. Rails는 다양한 캐싱 메커니즘을 제공하며, 각각의 용도와 특징이 있다. 1. Page Caching 페이지 캐싱은 컨트롤러 액션의 전체 HTML 출력을 정적 ...</p></div></div></a></div><div class="card"> <a href="/posts/transaction/"><div class="card-body"> <em class="small" data-ts="1663897317" data-df="ll" > Sep 23, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Transaction, Normalization</h3><div class="text-muted small"><p> 트랜잭션이란? 성공, 실패 두결과만 존재한다. 트랜잭션은 여러개의 작업을 하나로 묶은 실행 유닛이다. 각 트랜잭션은 하나의 특정 작업으로 시작을 해 묶여 있는 모든 작업들을 다 완료해야 정상적으로 종료된다. 여러개의 작업 중 단 하나의 작업을 실패하면 실패한 트랜잭션이라는 소리다.(롤백) 아래의 코드가 롤백과 커밋을 나타낸 예이다. ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/rails_cache/" class="btn btn-outline-primary" prompt="Older"><p>Ruby on Rails 성능 최적화: 레일즈 캐싱</p></a><div class="btn btn-outline-primary disabled" prompt="Newer"><p>-</p></div></div></div></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/cs/">cs</a> <a class="post-tag" href="/tags/design-pattern/">design pattern</a> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/spring/">spring</a> <a class="post-tag" href="/tags/mysql/">mysql</a> <a class="post-tag" href="/tags/rails/">rails</a> <a class="post-tag" href="/tags/sql/">sql</a> <a class="post-tag" href="/tags/algorithm/">algorithm</a> <a class="post-tag" href="/tags/questions/">questions</a> <a class="post-tag" href="/tags/ruby-on-rails/">ruby-on-rails</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://github.com/msKim0425">Minsub Kim</a>.</p></div></div></footer><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
