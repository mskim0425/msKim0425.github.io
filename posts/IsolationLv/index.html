<!DOCTYPE html><html lang="en" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Isolation Level + Inno DB Lock" /><meta property="og:locale" content="en" /><meta name="description" content="선착순 이벤트를 한다? 100명까지 위와 같은 이벤트를 진행한다고 가정했을 떄, 99번째때 참가자가 0.01초까지 같다고 가정했을 때, 누구를 선택할것인가? 필자같은 경우는 wiselife 프로젝트에서 챌린지 인증시각이 10:00시~ 10:10분까지인데 10:09:59 인 사람이 인증을 했을 때, 서버 응답시간으로 인해 인증을 못한다면? 서비스 센터에 바로 전화가 올 것이다. 이렇게 엄격하게 ACID특성을 지키면 동시성(Concurrency)를 해결 할 수 없을 것이다. 이 점을 해결할 수 있는 부분이 Transaction의 격리 레벨인 Isolation LV이다. 격리성을 덜 지키는 대신 더 좋은 동시성을 얻을 수 있다." /><meta property="og:description" content="선착순 이벤트를 한다? 100명까지 위와 같은 이벤트를 진행한다고 가정했을 떄, 99번째때 참가자가 0.01초까지 같다고 가정했을 때, 누구를 선택할것인가? 필자같은 경우는 wiselife 프로젝트에서 챌린지 인증시각이 10:00시~ 10:10분까지인데 10:09:59 인 사람이 인증을 했을 때, 서버 응답시간으로 인해 인증을 못한다면? 서비스 센터에 바로 전화가 올 것이다. 이렇게 엄격하게 ACID특성을 지키면 동시성(Concurrency)를 해결 할 수 없을 것이다. 이 점을 해결할 수 있는 부분이 Transaction의 격리 레벨인 Isolation LV이다. 격리성을 덜 지키는 대신 더 좋은 동시성을 얻을 수 있다." /><link rel="canonical" href="https://mskim0425.github.io/posts/IsolationLv/" /><meta property="og:url" content="https://mskim0425.github.io/posts/IsolationLv/" /><meta property="og:site_name" content="SoThoughtful;" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2023-01-26T12:20:57+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Isolation Level + Inno DB Lock" /><meta name="twitter:site" content="@" /><meta name="google-site-verification" content="jbF7fLQfFijq2Mi-8IkGRoUPQhLTlkTskBtbAoEmH4o" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2023-02-24T16:40:45+09:00","datePublished":"2023-01-26T12:20:57+09:00","description":"선착순 이벤트를 한다? 100명까지 위와 같은 이벤트를 진행한다고 가정했을 떄, 99번째때 참가자가 0.01초까지 같다고 가정했을 때, 누구를 선택할것인가? 필자같은 경우는 wiselife 프로젝트에서 챌린지 인증시각이 10:00시~ 10:10분까지인데 10:09:59 인 사람이 인증을 했을 때, 서버 응답시간으로 인해 인증을 못한다면? 서비스 센터에 바로 전화가 올 것이다. 이렇게 엄격하게 ACID특성을 지키면 동시성(Concurrency)를 해결 할 수 없을 것이다. 이 점을 해결할 수 있는 부분이 Transaction의 격리 레벨인 Isolation LV이다. 격리성을 덜 지키는 대신 더 좋은 동시성을 얻을 수 있다.","headline":"Isolation Level + Inno DB Lock","mainEntityOfPage":{"@type":"WebPage","@id":"https://mskim0425.github.io/posts/IsolationLv/"},"url":"https://mskim0425.github.io/posts/IsolationLv/"}</script><title>Isolation Level + Inno DB Lock | SoThoughtful;</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="SoThoughtful;"><meta name="application-name" content="SoThoughtful;"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="https://avatars.githubusercontent.com/u/107451298?s=400&u=e5165c561ac67ec7819798bbd37382f3630f4a99&v=4" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title"> <a href="/">SoThoughtful;</a></div><div class="site-subtitle font-italic">백엔드 개발자</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>REFERENCE</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/msKim0425" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['mins402kim','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="https://www.linkedin.com/in/%EB%AF%BC%EC%84%AD-%EA%B9%80-610901191/" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Isolation Level + Inno DB Lock</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Isolation Level + Inno DB Lock</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1674703257" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Jan 26, 2023 </em> </span> <span> Updated <em class="" data-ts="1677224445" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Feb 24, 2023 </em> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://github.com/msKim0425">Minsub Kim</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="3150 words"> <em>17 min</em> read</span></div></div></div><div class="post-content"><h2 id="선착순-이벤트를-한다-100명까지"><span class="mr-2">선착순 이벤트를 한다? 100명까지</span><a href="#선착순-이벤트를-한다-100명까지" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>위와 같은 이벤트를 진행한다고 가정했을 떄, 99번째때 참가자가 0.01초까지 같다고 가정했을 때, 누구를 선택할것인가? <br /> 필자같은 경우는 wiselife 프로젝트에서 챌린지 인증시각이 10:00시~ 10:10분까지인데 10:09:59 인 사람이 인증을 했을 때, 서버 응답시간으로 인해 인증을 못한다면? 서비스 센터에 바로 전화가 올 것이다.<br /> 이렇게 엄격하게 ACID특성을 지키면 동시성(Concurrency)를 해결 할 수 없을 것이다. 이 점을 해결할 수 있는 부분이 Transaction의 격리 레벨인 Isolation LV이다. <br /> 격리성을 덜 지키는 대신 더 좋은 동시성을 얻을 수 있다.</p><h2 id="일관성정합성--동시성"><span class="mr-2">일관성=정합성 ∝ 동시성</span><a href="#일관성정합성--동시성" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p><code class="language-plaintext highlighter-rouge">동시성 제어</code>란 동시에 실행되는 트랜잭션의 수를 최대화 하는 것과 데이터 CRUD 시 데이터의 무결성을 유지하는 것이다. 이것은 트레이드 오프 관계인지라 동시성이 증가하면 일관성은 감소할 수 밖에 없는 반비례 관계이다. <img data-src="https://dataonair.or.kr/images/know/tech/090709_vds1.jpg" data-proofer-ignore></p><p>또한 동시성은 ‘낙관적 동시성 제어’와 ‘비관적 동시성 제어’로 나뉘는데,</p><p><code class="language-plaintext highlighter-rouge">낙관적 동시성 제어</code><br /> <strong>같은 데이터를 동시에 수정하지 않을 것으로 가정</strong>하고 데이터를 읽는 시점에 락을 걸진 않지만 수정하는 시점에서 기존에 읽어온 데이터가 다른 사용자에 의해 변경되었는지 재검사가 필요한 경우</p><p><code class="language-plaintext highlighter-rouge">비관적 동시성 제어</code><br /> <strong>같은 데이터를 동시에 수정할 것으로 가정</strong>하고 데이터를 읽는 시점에서 락을 걸고 조회, 갱신 완료 시까지 락을 유지하는 경우</p><h2 id="innodb-lock"><span class="mr-2">InnoDB LOCK</span><a href="#innodb-lock" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>LOCK은 트랜잭션 처리의 절차를 보장하기 위한 방법이다. 격리단계에 따라 더 느슨하게 더 강하게 lock을 거는 것이다. 또한, DBMS별로 구현방식과 세부적인 방법이 제각각이기에 사용법을 알고 사용해한다. 필자는 MySQL의 InnoDB의 LOCK을 말할 예정이다.</p><h2 id="네임드락"><span class="mr-2">네임드락</span><a href="#네임드락" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="k">SELECT</span> <span class="n">GET_LOCK</span><span class="p">(</span><span class="s1">'락이름'</span><span class="p">,</span> <span class="mi">30</span><span class="p">);</span> <span class="o">//</span><span class="mi">30</span><span class="err">초</span> <span class="err">리밋의</span> <span class="err">락을</span> <span class="err">만드는것</span>
<span class="k">SELECT</span> <span class="n">IS_FREE_LOC</span><span class="p">(</span><span class="s1">'락이름'</span><span class="p">);</span>
</pre></table></code></div></div><p>디비복제를 하던가 데이터를 넘겨야할떄 사용하는 락</p><h3 id="shared-and-exclusive-locks"><span class="mr-2">Shared and Exclusive Locks</span><a href="#shared-and-exclusive-locks" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>InnoDB는 공유(S) 잠금과 배타적(X) 잠금의 두 가지 유형의 잠금이 있는 표준 행 수준 잠금을 구현한다.</p><blockquote class="prompt-tip"><div><p><code class="language-plaintext highlighter-rouge">S lock = Read lock</code> S LOCK을 사용하는 쿼리끼는 같은 row에 접근이 가능하다. <br /> 내가 이 테이블 읽을꺼니까 <code class="language-plaintext highlighter-rouge">입력하지마!</code><br /> LOCK TABLES test READ;<br /> UNLOCK TABLES;</p><p><code class="language-plaintext highlighter-rouge">X lock = Write lock</code> X LOCK이 걸린 row는 어떠한 쿼리도 접근 불가능<br /> 내가 이테이블 수정할꺼니까 <code class="language-plaintext highlighter-rouge">읽지마!</code><br /> LOCK TABLES test READ;</p></div></blockquote><h3 id="record-lock"><span class="mr-2">Record lock</span><a href="#record-lock" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>해당 레코드 락은 row가 아닌 DB의 인덱스 레코드에 걸리는 락이다.</p><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="err">트랜잭션</span> <span class="n">A</span>
<span class="k">SELECT</span> <span class="n">s1</span> <span class="k">FROM</span> <span class="n">studnet</span> <span class="k">WHERE</span> <span class="n">s1</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">FOR</span> <span class="k">UPDATE</span><span class="p">;</span> 

<span class="err">트랜잭션</span> <span class="n">B</span>
<span class="k">DELETE</span> <span class="k">FROM</span> <span class="n">student</span> <span class="k">where</span> <span class="n">s1</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</pre></table></code></div></div><p>트랜잭션 A쿼리가 실행되었을떄 student.s1의 값이 1인 인덱스에 X lock이 걸린다. 이 경우에 트랜잭션 B의 쿼리를 실행하려고하면, student.s1의 값이 1인 인덱스에 똑같이 X lock을 걸려고 시도하지만 이미 선점되어있는 상태이기 떄문에 트랜잭션A가 실행완료되기 전까지는 해당 s1 학생을 삭제할 수 없다.</p><h3 id="gap-lock"><span class="mr-2">Gap lock</span><a href="#gap-lock" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Gap lock은 DB index record의 gap에 걸리는 lock이다. 여기서 gap이란 index 중 DB에 실제 record가 없는 부분이다. <br /> 이게 무슨말이냐 하면..아래와 같은 테이블이 있고 현재 ID 칼럼에 인덱스가 걸려있는 상황이다.<br /> <code class="language-plaintext highlighter-rouge">1~4까지 락이 걸린상태 SELECT ID from t1 where ID BETWEEN 1 AND 5 FOR UPDATE;</code></p><div class="table-wrapper"><table><thead><tr><th style="text-align: center">ID<th style="text-align: center">NAME<tbody><tr><td style="text-align: center">2<td style="text-align: center"> <tr><td style="text-align: center">3<td style="text-align: center">홍길동<tr><td style="text-align: center">4<td style="text-align: center"> <tr><td style="text-align: center">5<td style="text-align: center">아무개</table></div><p>현재 2와 4는 인덱스 레코드가 없다. 이 부분을 index record의 gap이라한다.</p><p>위처럼 <code class="language-plaintext highlighter-rouge">gap lock은 해당 gap에 접근하려는 다른 쿼리의 접근을 막는다</code>. 이는 Record lock이 해당 index를 탈 때, 다른 쿼리의 접근을 막는 것과 동일하다. 둘의 차이점은 <code class="language-plaintext highlighter-rouge">record lock</code>이 이미 존재하는 row가 변경되지 않도록 보호하는 반면 <br /> <code class="language-plaintext highlighter-rouge">gap lock</code>은 조건에 해당하는 새로운 row가 추가되는 것을 방지하기 위함이다.</p><blockquote class="prompt-tip"><div><p>그 외에도 다양한 락들이 존재한다. <a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-locking.html#innodb-intention-locks">dev.mysql.com</a> 참고하시라</p></div></blockquote><h2 id="격리단계"><span class="mr-2">격리단계</span><a href="#격리단계" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p><code class="language-plaintext highlighter-rouge">Read Uncommitted</code> <br /> 가장 낮은 격리 수준, 커밋되지 않은 데이터를 읽을 수 있다.<br /> ROLLBACK이 될 데이터도 읽어올 수 있으므로 주의가 필요하다.<br /> LOCK이 발생하지 않는다.<br /> <code class="language-plaintext highlighter-rouge">Read Committed</code> <br /> 커밋된 데이터만 읽을 수 있다.<br /> read operation마다 스냅샷을 저장한다. <br /> 구현 방식이 차이 때문에 Query를 수행한 시점의 데이터와 정확하게 일치하지 않을 수 있다. <br /> LOCK이 발생하지 않는다. <br /> <strong>MySQL에서 많은 양의 데이터를 복제하거나 이동할 때 이 LEVEL을 추천한다.</strong><br /> <code class="language-plaintext highlighter-rouge">Repetable Read</code></p><ol><li>MySQL Default Level이고, 한 번 조회한 데이터를 반복해서 조회해도 같은 데이터가 조회된다.</ol><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="n">mysql</span> <span class="err">디폴트</span> <span class="err">설정</span>

<span class="n">mysql</span><span class="o">&gt;</span> <span class="k">SHOW</span> <span class="n">VARIABLES</span> <span class="k">WHERE</span> <span class="n">VARIABLE_NAME</span><span class="o">=</span><span class="s1">'tx_isolation'</span><span class="p">;</span>
<span class="o">+</span><span class="c1">---------------+-----------------+</span>
<span class="o">|</span> <span class="n">Variable_name</span> <span class="o">|</span> <span class="n">Value</span>           <span class="o">|</span>
<span class="o">+</span><span class="c1">---------------+-----------------+</span>
<span class="o">|</span> <span class="n">tx_isolation</span>  <span class="o">|</span> <span class="k">REPEATABLE</span><span class="o">-</span><span class="k">READ</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">---------------+-----------------+</span>
<span class="mi">1</span> <span class="k">row</span> <span class="k">in</span> <span class="k">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>
</pre></table></code></div></div><ol><li>SELECT시 현재 시점의 스냅샷을 만들고 스냅샷을 조회한다. 즉, 처음으로 read operation (SELECT)을 수행한 시간을 기록한다. 그리고 모든 read operation마다 해당 시점을 기준으로 consistent read를 수행한다. 그러므로 트랜잭션 도중에 다른 트랜잭션이 커밋되더라도 새로 커밋된 데이터는 조회되지 않는다. 이유는 첫 read시의 스냅샷이 보이기 떄문이다.<li>record lock과 gap lock이 발생</ol><p><code class="language-plaintext highlighter-rouge">Serializable</code> <br /> 가장 엄격한 격리 수준이다. <br /> SELECT 문에 사용하는 모든 테이블에 shared lock이 발생한다.</p><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="p">(</span><span class="n">A</span><span class="p">)</span> <span class="k">SELECT</span> <span class="k">state</span> <span class="k">FROM</span> <span class="n">account</span> <span class="k">WHERE</span> <span class="n">id</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> 
<span class="p">(</span><span class="n">B</span><span class="p">)</span> <span class="k">SELECT</span> <span class="k">state</span> <span class="k">FROM</span> <span class="n">account</span> <span class="k">WHERE</span> <span class="n">id</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">(</span><span class="n">B</span><span class="p">)</span> <span class="k">UPDATE</span> <span class="n">account</span> <span class="k">SET</span> <span class="k">state</span> <span class="o">=</span> <span class="err">‘</span><span class="n">rich</span><span class="err">’</span><span class="p">,</span> <span class="n">money</span> <span class="o">=</span> <span class="n">money</span> <span class="o">*</span> <span class="mi">1000</span> <span class="k">WHERE</span> <span class="n">id</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> 
<span class="p">(</span><span class="n">B</span><span class="p">)</span> <span class="k">COMMIT</span><span class="p">;</span>
<span class="p">(</span><span class="n">A</span><span class="p">)</span> <span class="k">UPDATE</span> <span class="n">account</span> <span class="k">SET</span> <span class="k">state</span> <span class="o">=</span> <span class="err">‘</span><span class="n">rich</span><span class="err">’</span><span class="p">,</span> <span class="n">money</span> <span class="o">=</span> <span class="n">money</span> <span class="o">*</span> <span class="mi">1000</span> <span class="k">WHERE</span> <span class="n">id</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">(</span><span class="n">A</span><span class="p">)</span> <span class="k">COMMIT</span><span class="p">;</span>
</pre></table></code></div></div><div class="table-wrapper"><table><thead><tr><th>트랜잭션 A<th>트랜잭션 B<tbody><tr><td>BEGIN<td> <tr><td>SELECT state FROM account WHERE id = 1 <code class="language-plaintext highlighter-rouge">S lock 발동</code><td> <tr><td> <td>BEGIN<tr><td> <td>SELECT state FROM account WHERE id = 1 <code class="language-plaintext highlighter-rouge">S lock 발동</code><tr><td><code class="language-plaintext highlighter-rouge">X lock실패</code><td>UPDATE account SET state = ‘rich’, money = money * 1000 WHERE id = 1<tr><td> <td>COMMIT<tr><td>UPDATE account SET state = ‘rich’, money = money * 1000 WHERE id = 1<td><code class="language-plaintext highlighter-rouge">X lock실패</code><tr><td>COMMIT<td> </table></div><p>row에 S lock이 걸려있으므로 데드락 상태로 전환되고 두 개의 트랜잭션은 모두 timeout된다. 즉, 돈은 원금 그대로 남아있게 된다. <br /> 이처럼 데이터는 보호되지만 쉽게 데드락이 될 수 있으므로 무차별적으로 사용하면 안된다.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>  <span class="c1">// 별도로 정의하지 않으면 DB의 Isolation Level을 따름</span>
  <span class="nd">@Transactional</span><span class="o">(</span><span class="n">isolation</span> <span class="o">=</span> <span class="nc">Isolation</span><span class="o">.</span><span class="na">DEFAULT</span><span class="o">)</span>
  <span class="nd">@Transactional</span><span class="o">(</span><span class="n">isolation</span> <span class="o">=</span> <span class="nc">Isolation</span><span class="o">.</span><span class="na">READ_UNCOMMITTED</span><span class="o">)</span>
  <span class="nd">@Transactional</span><span class="o">(</span><span class="n">isolation</span> <span class="o">=</span> <span class="nc">Isolation</span><span class="o">.</span><span class="na">READ_COMMITTED</span><span class="o">)</span>
  <span class="nd">@Transactional</span><span class="o">(</span><span class="n">isolation</span> <span class="o">=</span> <span class="nc">Isolation</span><span class="o">.</span><span class="na">REPEATABLE_READ</span><span class="o">)</span>
  <span class="nd">@Transactional</span><span class="o">(</span><span class="n">isolation</span> <span class="o">=</span> <span class="nc">Isolation</span><span class="o">.</span><span class="na">SERIALIZABLE</span><span class="o">)</span>
  
</pre></table></code></div></div><h4 id="계속해서-언급된-consistent-read이란"><span class="mr-2">계속해서 언급된 Consistent read이란?</span><a href="#계속해서-언급된-consistent-read이란" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>read(=SELECT) operation을 수행할 때 현재 DB의 값이 아닌 특정 시점의 DB snapshot을 읽어오는 것이다. snapshot은 commit 된 변화만이 적용된 상태를 의미한다.</p><p>row에 lock을 걸어 다른 transaction이 할 수 없도록 하는 방법이 가장 단순한 방법이지만 InnoDB 엔진은 동시성이 매우 떨어지기 때문에 consistent read를 하기 위해 lock을 사용하지 않는다.</p><p>InnoDB 엔진은 실행했던 <code class="language-plaintext highlighter-rouge">쿼리의 log를 통해 consistent read를 지원</code>한다. InnoDB 엔진은 각 쿼리를 실행할 때마다 실행한 쿼리의 log를 차곡차곡 저장한다. 그리고 나중에 consistent read를 할 때 이 log를 통해 특정 시점의 DB snapshot을 복구하여 가져온다. 이 방식은 비록 복구하는 비용이 발생하긴 하지만, lock을 활용하는 방식보다 높은 동시성을 얻을 수 있다.</p><p>한가지 주의해야하는 점은 Update나 Delete같은 DML 쿼리에서는 해당 Consistent read를 적용받지 않는다. where 조건을 사용해도 내가 수정하려고 한 select쿼리로 읽어온 row와 해당 row들을 수정하기 위해서 update 쿼리를 날렸을때 수정되는 row가 다를수 있다는 것이다.</p><p>아래는 두 트랜잭션이 REPEATABLE READ가 아래와 같이 일어났을때를 나타낸 것이다.</p><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="err">트랜잭션</span> <span class="n">A</span> <span class="o">-</span> <span class="k">isolation</span><span class="p">:</span> <span class="k">READ</span> <span class="k">COMMITTED</span>
<span class="k">SELECT</span> <span class="k">COUNT</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">STUDENT</span> <span class="k">WHERE</span> <span class="n">name</span> <span class="o">=</span> <span class="s1">'TOM'</span><span class="p">;</span>
<span class="k">DELETE</span> <span class="k">FROM</span> <span class="n">STUDENT</span> <span class="k">WHERE</span> <span class="n">name</span> <span class="o">=</span> <span class="s1">'TOM'</span><span class="p">;</span>
<span class="k">COMMIT</span><span class="p">;</span>

<span class="err">트랜잭션</span> <span class="n">B</span> <span class="o">-</span> <span class="k">isolation</span><span class="p">:</span> <span class="k">READ</span> <span class="k">COMMITTED</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">STUDENT</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">score</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">'TOM'</span><span class="p">,</span><span class="mi">100</span><span class="p">),(</span><span class="s1">'TOM'</span><span class="p">,</span><span class="mi">95</span><span class="p">),(</span><span class="s1">'TOM'</span><span class="p">,</span><span class="mi">90</span><span class="p">);</span>
<span class="k">COMMIT</span><span class="p">;</span>

<span class="err">두</span> <span class="err">트랜잭션이</span> <span class="err">아래와같이</span> <span class="err">일어났을떄</span>
<span class="p">(</span><span class="n">A</span><span class="p">)</span> <span class="k">SELECT</span> <span class="k">COUNT</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">STUDENT</span> <span class="k">WHERE</span> <span class="n">name</span> <span class="o">=</span> <span class="s1">'TOM'</span><span class="p">;</span> <span class="o">//</span> <span class="err">데이터가</span> <span class="err">없는</span> <span class="err">상황이므로</span> <span class="err">실행결과는</span> <span class="mi">0</span> 
<span class="p">(</span><span class="n">B</span><span class="p">)</span> <span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">STUDENT</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">score</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">'TOM'</span><span class="p">,</span><span class="mi">100</span><span class="p">),(</span><span class="s1">'TOM'</span><span class="p">,</span><span class="mi">95</span><span class="p">),(</span><span class="s1">'TOM'</span><span class="p">,</span><span class="mi">90</span><span class="p">);</span>  <span class="o">//</span><span class="n">non</span> <span class="k">lock</span> <span class="err">상태이므로</span> <span class="err">해당</span> <span class="err">쿼리</span> <span class="err">실행</span>
<span class="p">(</span><span class="n">B</span><span class="p">)</span> <span class="k">COMMIT</span><span class="p">;</span>
<span class="p">(</span><span class="n">A</span><span class="p">)</span> <span class="k">DELETE</span> <span class="k">FROM</span> <span class="n">STUDENT</span> <span class="k">WHERE</span> <span class="n">name</span> <span class="o">=</span> <span class="s1">'TOM'</span><span class="p">;</span> <span class="o">//</span> <span class="mi">3</span> <span class="k">rows</span> <span class="err">삭제</span>
<span class="p">(</span><span class="n">A</span><span class="p">)</span> <span class="k">COMMIT</span><span class="p">;</span>
</pre></table></code></div></div><p>위처럼 consistent read에는 보이지 않는 row에 DML 쿼리가 영향을 준 경우, 그 시점 이후로는 해당 row가 transaction에 보이기 시작한다.<br /> 위와같은 상황을 회피하기 위해 SERIALIZABLE을 써야한다는 것이다.</p><h2 id="격리-수준이-낮을때-발생되는-문제점"><span class="mr-2">격리 수준이 낮을때 발생되는 문제점</span><a href="#격리-수준이-낮을때-발생되는-문제점" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="dirty-read"><span class="mr-2">Dirty read</span><a href="#dirty-read" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>커밋이 완료되지 않은 데이터를 다른 트랜잭션이 읽는 케이스. 이로인해 최종 결과가 비일관적으로 저장될 수 있다.</p><blockquote><p>Transaction A에서 row를 삽입했다.<br /> READ UNCOMMITTED transaction B가 해당 row를 읽는다.<br /> Transaction A가 rollback 된다.<br /> B는 존재하지않은 데이터를 읽은 케이스르 Dirty read라고 한다.</p></blockquote><p>이것이 가능한 이유는 InnoDB 엔진이 transaction을 commit 하는 방법 때문이다. InnoDB 엔진은 커밋이 적용됐던 안됐던 일단 실행된 모든 쿼리를 DB에 적용한다. <br /> 즉, 특정 log를 보고 특정 시점의 snapshot을 복구하는 consistent read를 하지 않고 그냥 해당 시점의 DB를 읽으면 dirty read가 된다. 아래는 해당 내용을 언급한 MySQL reference의 내용이다.</p><blockquote><p>InnoDB는 커밋에 낙관적 메커니즘을 사용하므로 커밋이 실제로 발생하기 전에 데이터 파일에 변경 사항을 기록할 수 있습니다. 이 기술은 롤백의 경우 더 많은 작업이 필요하다는 단점과 함께 커밋 자체를 더 빠르게 만듭니다.</p></blockquote><h3 id="non-repeatable-read"><span class="mr-2">Non Repeatable Read</span><a href="#non-repeatable-read" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>반복해서 같은 데이터를 읽을 수 없게 되는 케이스. 한 트랜잭션에서 같은 쿼리를 두 번 수행할 때 그 사이에 다른 트랜잭션이 값을 수정/삭제하므로 두 쿼리의 결과가 상이하게 나타나는 비 일관성의 문제가 발생한다.</p><h3 id="phantom-read"><span class="mr-2">Phantom Read</span><a href="#phantom-read" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>반복 조회 시, 결과 집합이 달라지는 케이스. 한 트랜잭션 안에서 일정 범위의 레코드를 두 번 읽을 때, 처음 결과에 없던 레코드가 두 번째에서는 나타나는 문제</p><p>이렇게 총 4가지 케이스가 있는데 격리수준을 낮게 했을 때, 발생되는 문제점은 아래와 같다.</p><div class="table-wrapper"><table><thead><tr><th> <th style="text-align: center">Dirty read<th style="text-align: center">Non Repeatable Read<th style="text-align: center">Phantom Read<tbody><tr><td>Read Uncommitted<td style="text-align: center">0<td style="text-align: center">0<td style="text-align: center">0<tr><td>Read Committed<td style="text-align: center"> <td style="text-align: center">0<td style="text-align: center">0<tr><td>Repetable Read<td style="text-align: center"> <td style="text-align: center"> <td style="text-align: center">0<tr><td>Serializable<td style="text-align: center"> <td style="text-align: center"> <td style="text-align: center"> </table></div><h2 id="what-i-learn"><span class="mr-2">what I learn</span><a href="#what-i-learn" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>row를 읽을떄는 디폴트 설정인 Repetable Read, CRUD를 진행할떄는 Serializable을 사용해서 진행했는데, 이젠 적절하게 isolation을 낮추면서 동시성을 높일수 있는 여러 LV을 고려하여 선택해야겠다.</p><h2 id="출처"><span class="mr-2">출처</span><a href="#출처" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>https://dev.mysql.com/doc/refman/5.6/en/innodb-transaction-isolation-levels.html) https://dev.mysql.com/doc/refman/5.6/en/innodb-locking.html<br /> https://dev.mysql.com/doc/refman/8.0/en/innodb-locking-transaction-model.html https://blog.sapzil.org/2017/04/01/do-not-trust-sql-transaction<br /> https://jupiny.com/2018/11/30/mysql-transaction-isolation-levels</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/sql/'>SQL</a>, <a href='/categories/lock/'>LOCK</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/sql/" class="post-tag no-text-decoration" >sql</a> <a href="/tags/db/" class="post-tag no-text-decoration" >db</a> <a href="/tags/lock/" class="post-tag no-text-decoration" >lock</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Isolation+Level+%2B+Inno+DB+Lock+-+SoThoughtful%3B&url=https%3A%2F%2Fmskim0425.github.io%2Fposts%2FIsolationLv%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Isolation+Level+%2B+Inno+DB+Lock+-+SoThoughtful%3B&u=https%3A%2F%2Fmskim0425.github.io%2Fposts%2FIsolationLv%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fmskim0425.github.io%2Fposts%2FIsolationLv%2F&text=Isolation+Level+%2B+Inno+DB+Lock+-+SoThoughtful%3B" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fmskim0425.github.io%2Fposts%2FIsolationLv%2F" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div><script src="https://utteranc.es/client.js" repo="mskim0425/mskim0425.github.io" issue-term="pathname" theme="github-dark" crossorigin="anonymous" async> </script></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/java-basic-2/">Basic Confusing Questions Ⅱ 🤷‍♂️ (17개)</a><li><a href="/posts/query_series1/">mysql 쿼리 기능</a><li><a href="/posts/about_index/">INDEX에 관하여</a><li><a href="/posts/useful_gems/">Ruby GEM 시리즈</a><li><a href="/posts/debug_rails/">Rails 디버깅</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/cs/">cs</a> <a class="post-tag" href="/tags/design-pattern/">design pattern</a> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/spring/">spring</a> <a class="post-tag" href="/tags/mysql/">mysql</a> <a class="post-tag" href="/tags/rails/">rails</a> <a class="post-tag" href="/tags/sql/">sql</a> <a class="post-tag" href="/tags/algorithm/">algorithm</a> <a class="post-tag" href="/tags/questions/">questions</a> <a class="post-tag" href="/tags/ruby-on-rails/">ruby-on-rails</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4 mt-5"><div id="related-posts" class="mb-2 mb-sm-4"><h3 class="pt-2 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/transaction/"><div class="card-body"> <em class="small" data-ts="1663897317" data-df="ll" > Sep 23, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Transaction, Normalization</h3><div class="text-muted small"><p> 트랜잭션이란? 성공, 실패 두결과만 존재한다. 트랜잭션은 여러개의 작업을 하나로 묶은 실행 유닛이다. 각 트랜잭션은 하나의 특정 작업으로 시작을 해 묶여 있는 모든 작업들을 다 완료해야 정상적으로 종료된다. 여러개의 작업 중 단 하나의 작업을 실패하면 실패한 트랜잭션이라는 소리다.(롤백) 아래의 코드가 롤백과 커밋을 나타낸 예이다. ...</p></div></div></a></div><div class="card"> <a href="/posts/persistence-context/"><div class="card-body"> <em class="small" data-ts="1672985464" data-df="ll" > Jan 6, 2023 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Persistence Context</h3><div class="text-muted small"><p> 영속성 컨텍스트 JPA를 사용함에 있어 가장 중요한 개념이자 Entity를 영구 저장하는 환경이다. 논리적인 개념이기에 자주 까먹어서 이참에 정리하고자 한다. 프레임워크랑 DB 사이에 있는 논리적인 공간 엔티티의 생명주기 왜 뜬금없이 엔티티의 생명주기냐 하겠지만, 영속성 컨텍스트를 이해하는데 땔 수 없는 관계이기에 설명하고자 한다. ...</p></div></div></a></div><div class="card"> <a href="/posts/about-index/"><div class="card-body"> <em class="small" data-ts="1677117664" data-df="ll" > Feb 23, 2023 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Index... 랜덤 Io, 순차 IO</h3><div class="text-muted small"><p> 인덱스 인덱스를 왜쓸까? 인덱스는 조회성능 개선 - 디스크 I/O를 줄이는게 핵심이다. 테이블의 특정 데이터를 생성한다면, 해당 컬럼의 데이터를 정렬 후, 별도의 메모리 공간에 데이터의 물리적 주소를 Key, Value 형태로 저장한다. 많은 쿼리들의 대부분의 요청은 GET요청 방식이다. 수정 삭제에서 손해를 보더라도 검색속도와 시스템의 부하가...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/java-version/" class="btn btn-outline-primary" prompt="Older"><p>Java 8-17 정리</p></a> <a href="/posts/spring300/" class="btn btn-outline-primary" prompt="Newer"><p>Spring boot 3.0.0과 Spring Framework 6.x</p></a></div></div></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/cs/">cs</a> <a class="post-tag" href="/tags/design-pattern/">design pattern</a> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/spring/">spring</a> <a class="post-tag" href="/tags/mysql/">mysql</a> <a class="post-tag" href="/tags/rails/">rails</a> <a class="post-tag" href="/tags/sql/">sql</a> <a class="post-tag" href="/tags/algorithm/">algorithm</a> <a class="post-tag" href="/tags/questions/">questions</a> <a class="post-tag" href="/tags/ruby-on-rails/">ruby-on-rails</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://github.com/msKim0425">Minsub Kim</a>.</p></div></div></footer><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
