<!DOCTYPE html><html lang="en" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="cluster-index와 uncluster-index" /><meta property="og:locale" content="en" /><meta name="description" content="Cluster 란?" /><meta property="og:description" content="Cluster 란?" /><link rel="canonical" href="https://mskim0425.github.io/posts/clustered-index/" /><meta property="og:url" content="https://mskim0425.github.io/posts/clustered-index/" /><meta property="og:site_name" content="SoThoughtful;" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2023-05-17T12:01:04+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="cluster-index와 uncluster-index" /><meta name="twitter:site" content="@" /><meta name="google-site-verification" content="jbF7fLQfFijq2Mi-8IkGRoUPQhLTlkTskBtbAoEmH4o" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2023-09-20T22:32:42+09:00","datePublished":"2023-05-17T12:01:04+09:00","description":"Cluster 란?","headline":"cluster-index와 uncluster-index","mainEntityOfPage":{"@type":"WebPage","@id":"https://mskim0425.github.io/posts/clustered-index/"},"url":"https://mskim0425.github.io/posts/clustered-index/"}</script><title>cluster-index와 uncluster-index | SoThoughtful;</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="SoThoughtful;"><meta name="application-name" content="SoThoughtful;"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="https://avatars.githubusercontent.com/u/107451298?s=400&u=e5165c561ac67ec7819798bbd37382f3630f4a99&v=4" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title"> <a href="/">SoThoughtful;</a></div><div class="site-subtitle font-italic">백엔드 개발자</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>REFERENCE</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/msKim0425" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['mins402kim','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="https://www.linkedin.com/in/%EB%AF%BC%EC%84%AD-%EA%B9%80-610901191/" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>cluster-index와 uncluster-index</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>cluster-index와 uncluster-index</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1684292464" data-df="ll" data-toggle="tooltip" data-placement="bottom"> May 17, 2023 </em> </span> <span> Updated <em class="" data-ts="1695216762" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Sep 20, 2023 </em> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://github.com/msKim0425">Minsub Kim</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1122 words"> <em>6 min</em> read</span></div></div></div><div class="post-content"><h1 id="cluster-란">Cluster 란?</h1><p>Clustered Index는 단어뜻을 생각해보면 군집화된 인덱스이다. 즉 실제 데이터가 인덱스와 군집되어있다는 뜻이다.</p><p>클러스터링 인덱스와 넌 클러스터링 인덱스는 두 인덱스 모두 데이터베이스에서 데이터의 접근 속도를 높이기 위해 사용한다.</p><p><img data-src="https://github.com/mskim0425/msKim0425.github.io/blob/main/images/INDEX/%EA%B7%B8%EB%A6%BC1.png?raw=https://raw.githubusercontent.com/cotes2020/chirpy-images/maintrue" data-proofer-ignore></p><p>위 처럼 데이터가 들어오는데로 삽입된 상황의 테이블 구조가 있다고 가정해보자.<br /> 위 테이블은 인덱스가 적용이 안된 <code class="language-plaintext highlighter-rouge">한국인이 자주 시켜먹는 배달 순위</code>를 나타낸 Table이다.</p><h1 id="클러스터형-인덱스">클러스터형 인덱스</h1><p><img data-src="https://github.com/mskim0425/msKim0425.github.io/blob/main/images/INDEX/%EA%B7%B8%EB%A6%BC2.png?raw=https://raw.githubusercontent.com/cotes2020/chirpy-images/maintrue" data-proofer-ignore></p><p><code class="language-plaintext highlighter-rouge">클러스터형 인덱스</code>는 테이블 전체가 정렬된 인덱스가 되는 방식의 인덱스 종류이다. 인덱스에 따라 데이터가 지정된 열에 맞춰서 자동정렬되고 테이블 당 한개만 생성이 가능하다. innoDB에서는 디볼트 기본키를 기준으로 클러스터링되어 저장된다. 또는 Unique + Not null로 지정된 컬럼도 클러스터형 인덱스가 생성될 수 있다. (하지만 기본키가 더 우선권을 갖음)</p><p>위 그림처럼 B+Tree 형태로 구성되어있고 순위를 나타내는 컬럼을 PK로 설정해 <code class="language-plaintext highlighter-rouge">클러스터형 인덱스</code>를 만든 형태이다.<br /> 루트페이지가 Key값으로 PK를 가지고 있고 다른페이지의 번호를 포인터로 지니고 있다. 이러한 구조는 검색 속도를 빠르게 하지만, 생성, 업데이트, 삭제 부분에서는 새로 정렬을 해야하므로 느릴 수 밖에 없다.</p><h1 id="넌클러스터형-인덱스">넌클러스터형 인덱스</h1><p><img data-src="https://github.com/mskim0425/msKim0425.github.io/blob/main/images/INDEX/%EA%B7%B8%EB%A6%BC3.png?raw=https://raw.githubusercontent.com/cotes2020/chirpy-images/maintrue" data-proofer-ignore></p><p><code class="language-plaintext highlighter-rouge">넌클러스터형 인덱스</code>는 원본 데이터 페이지 그대로 유지하고 별도의 페이지에 넌 클러스터형 인덱스를 구성한다. 클러스터형 보다 검색속도는 느리지만 CUD는 빠르다. 데이터를 직접가리키는 것이 아닌 데이터의 위치를 가리키는 <code class="language-plaintext highlighter-rouge">포인터</code> 이기 떄문이다. 클러스터형과 다르게 여러개 생성 가능하다.</p><p>위그림을 보면 리프페이지에서 직접적으로 데이터를 가지고 있는 것이 아닌 <code class="language-plaintext highlighter-rouge">데이터 페이지 번호와 해당 행의 위치</code>를 저장하고 있다. 인덱스 페이지(Root + Leaf)는 정렬되어있으나 DATA page는 처음에 저장했던 순서 그대로이다.</p><h1 id="혼합된-클러스터형-인덱스--넌-클러스터형-인덱스">혼합된 클러스터형 인덱스 + 넌 클러스터형 인덱스</h1><p><img data-src="https://github.com/mskim0425/msKim0425.github.io/blob/main/images/INDEX/%EA%B7%B8%EB%A6%BC4.png?raw=https://raw.githubusercontent.com/cotes2020/chirpy-images/maintrue" data-proofer-ignore></p><p>보통 인덱스 처리를 할때, 위와같이 혼합해서 사용하는 경우가 많다. PK는 기본적으로 존재해야 테이블을 생성할 수 있고, 추가로 조회가 자주 발생하는 부분에 대해 인덱스를 처리하기 떄문이다. 이럴경우 위와같은 구조로 작동한다. <code class="language-plaintext highlighter-rouge">순위</code>에대해 PK를 지정하고 <code class="language-plaintext highlighter-rouge">음식</code>에 대해 클러스터형 인덱스를 설정한 모습이다.</p><p><em>넌클러스터형에 왜 PK값을 넣는거죠? 일 두번하는 거 아닌가요?</em> 라는 의문이 생길수 있다. 물론 조회만 일어나면 맞는말이지만, 만약에 테이블에 <code class="language-plaintext highlighter-rouge">1순위가 스테이크</code> 로 바뀌고 <code class="language-plaintext highlighter-rouge">치킨이 11위</code>로 밀렸다고 가정해보자. 기존의 경우에는 아래의 클러스터 인덱스 부분들만 정렬하고 음식 인덱스에 대해서는 값만 추가해주면 된다. 하지만 넌클러스터형의 예시처럼 데이터페이지의 주소와 값을 가지고 있다면 넌 클러스트형 인덱스까지 모두 수정해야하는일이 발생한다.</p><p>사실, 기본키값인 <code class="language-plaintext highlighter-rouge">순위</code>가 변동성이 큰 값이라 해당 예시가 적절지 못할수도 있다고 생각한다. 하지만, 핵심은 이렇게 간접적으로 데이터를 가짐으로써 인덱스의 이점과 CUD가 왔을때 최악의 상황을 방지하는 방지턱의 역할로 이해하면 좋을꺼 같다.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/cluster-index/'>cluster-index</a>, <a href='/categories/uncluser-index/'>uncluser-index</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/cluster-index/" class="post-tag no-text-decoration" >cluster-index</a> <a href="/tags/uncluser-index/" class="post-tag no-text-decoration" >uncluser-index</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=cluster-index%EC%99%80+uncluster-index+-+SoThoughtful%3B&url=https%3A%2F%2Fmskim0425.github.io%2Fposts%2Fclustered-index%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=cluster-index%EC%99%80+uncluster-index+-+SoThoughtful%3B&u=https%3A%2F%2Fmskim0425.github.io%2Fposts%2Fclustered-index%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fmskim0425.github.io%2Fposts%2Fclustered-index%2F&text=cluster-index%EC%99%80+uncluster-index+-+SoThoughtful%3B" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fmskim0425.github.io%2Fposts%2Fclustered-index%2F" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div><script src="https://utteranc.es/client.js" repo="mskim0425/mskim0425.github.io" issue-term="pathname" theme="github-dark" crossorigin="anonymous" async> </script></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/java-basic-2/">Basic Confusing Questions Ⅱ 🤷‍♂️ (17개)</a><li><a href="/posts/query_series1/">mysql 쿼리 기능</a><li><a href="/posts/about_index/">INDEX에 관하여</a><li><a href="/posts/useful_gems/">Ruby GEM 시리즈</a><li><a href="/posts/debug_rails/">Rails 디버깅</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/cs/">cs</a> <a class="post-tag" href="/tags/design-pattern/">design pattern</a> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/spring/">spring</a> <a class="post-tag" href="/tags/mysql/">mysql</a> <a class="post-tag" href="/tags/rails/">rails</a> <a class="post-tag" href="/tags/sql/">sql</a> <a class="post-tag" href="/tags/algorithm/">algorithm</a> <a class="post-tag" href="/tags/questions/">questions</a> <a class="post-tag" href="/tags/ruby-on-rails/">ruby-on-rails</a></div></div></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4 mt-5"><div id="related-posts" class="mb-2 mb-sm-4"><h3 class="pt-2 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/exception_rails/"><div class="card-body"> <em class="small" data-ts="1739673600" data-df="ll" > Feb 16, 2025 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Ruby on Rails Exception 그리고 트랜잭션</h3><div class="text-muted small"><p> 예외처리 프로그램 실행중에 발생할 수 있는 예외를 처리하고 무엇보다 중단되지않도록 사용하는 기법이다. 루비에서의 예외처리 기본구조는 아래와같다. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 begin # 예외가 발생할 수 있는 코드 rescue Exception =&amp;gt; e # 예외가 발생했을 때 처리할 코드...</p></div></div></a></div><div class="card"> <a href="/posts/rails_cache/"><div class="card-body"> <em class="small" data-ts="1737801600" data-df="ll" > Jan 25, 2025 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Ruby on Rails 성능 최적화: 레일즈 캐싱</h3><div class="text-muted small"><p> Rails에서 제공하는 캐싱(Caching)은 웹 애플리케이션의 성능을 향상시키기 위해 자주 사용되는 데이터나 결과를 저장하여 불필요한 데이터베이스 호출이나 복잡한 연산을 줄이는 기술이다. Rails는 다양한 캐싱 메커니즘을 제공하며, 각각의 용도와 특징이 있다. 1. Page Caching 페이지 캐싱은 컨트롤러 액션의 전체 HTML 출력을 정적 ...</p></div></div></a></div><div class="card"> <a href="/posts/rails_gc/"><div class="card-body"> <em class="small" data-ts="1737283200" data-df="ll" > Jan 19, 2025 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Ruby on Rails 성능 최적화: 가비지 컬렉션</h3><div class="text-muted small"><p> 정리하게된 계기 Rails App 경우 자바와 같이 object가 생성될떄 힙에 실제데이터를 올리고 있는데 메모리를 해제를 어떻게하는지 궁금해서 찾아보게 되었다. Ruby의 가비지 컬렉션(GC) 메커니즘은 메모리 관리의 핵심 부분이다. GC 모듈을 통해 이 과정을 이해하고 최적화할 수 있다. Rails 애플리케이션에서 메모리 사용...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/sse/" class="btn btn-outline-primary" prompt="Older"><p>SSE Spring에서 구현하기 A to Z</p></a> <a href="/posts/ruby_confuse/" class="btn btn-outline-primary" prompt="Newer"><p>ROR 사용시 혼동되는거 정리</p></a></div></div></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/cs/">cs</a> <a class="post-tag" href="/tags/design-pattern/">design pattern</a> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/spring/">spring</a> <a class="post-tag" href="/tags/mysql/">mysql</a> <a class="post-tag" href="/tags/rails/">rails</a> <a class="post-tag" href="/tags/sql/">sql</a> <a class="post-tag" href="/tags/algorithm/">algorithm</a> <a class="post-tag" href="/tags/questions/">questions</a> <a class="post-tag" href="/tags/ruby-on-rails/">ruby-on-rails</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://github.com/msKim0425">Minsub Kim</a>.</p></div></div></footer><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
